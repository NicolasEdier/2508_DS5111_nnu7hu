{{ config(materialized='table') }}

SELECT 
    symbol,
    COUNT(*) as occurrence_count
FROM (
    -- Yahoo Finance Gainers
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251013_143026
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251013_170014
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251013_203021
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251014_133020
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251014_170014
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251014_203018
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251015_133025
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251015_170016
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251015_203018
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251016_133020
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251016_170018
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251016_203014
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251017_133013
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251017_170015
    UNION ALL
    SELECT symbol FROM DS2508.NNU7HU.YGAINERS_20251017_203014
    
    -- Wall Street Journal Gainers
    UNION ALL
    SELECT REGEXP_SUBSTR(COMPANY, '\\(([A-Z]+)\\)', 1, 1, 'e') as symbol 
    FROM DS2508.NNU7HU.WSJGAINERS_20251013_143026
    UNION ALL
    SELECT REGEXP_SUBSTR(COMPANY, '\\(([A-Z]+)\\)', 1, 1, 'e') as symbol 
    FROM DS2508.NNU7HU.WSJGAINERS_20251013_203021
    UNION ALL
    SELECT REGEXP_SUBSTR(COMPANY, '\\(([A-Z]+)\\)', 1, 1, 'e') as symbol 
    FROM DS2508.NNU7HU.WSJGAINERS_20251014_133020
    UNION ALL
    SELECT REGEXP_SUBSTR(COMPANY, '\\(([A-Z]+)\\)', 1, 1, 'e') as symbol 
    FROM DS2508.NNU7HU.WSJGAINERS_20251014_203018
    UNION ALL
    SELECT REGEXP_SUBSTR(COMPANY, '\\(([A-Z]+)\\)', 1, 1, 'e') as symbol 
    FROM DS2508.NNU7HU.WSJGAINERS_20251015_133025
    UNION ALL
    SELECT REGEXP_SUBSTR(COMPANY, '\\(([A-Z]+)\\)', 1, 1, 'e') as symbol 
    FROM DS2508.NNU7HU.WSJGAINERS_20251016_133020
    UNION ALL
    SELECT REGEXP_SUBSTR(COMPANY, '\\(([A-Z]+)\\)', 1, 1, 'e') as symbol 
    FROM DS2508.NNU7HU.WSJGAINERS_20251017_170015
    UNION ALL
    SELECT REGEXP_SUBSTR(COMPANY, '\\(([A-Z]+)\\)', 1, 1, 'e') as symbol 
    FROM DS2508.NNU7HU.WSJGAINERS_20251017_203014
)
WHERE symbol IS NOT NULL AND symbol != ''
GROUP BY symbol
ORDER BY occurrence_count DESC, symbol
